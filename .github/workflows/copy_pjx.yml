name: Push to Another Repository

on:
  push:
    branches:
      - main  # 修改为适用的分支

jobs:
  push:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Debugging environment
        run: |
          git remote -v
          curl -H "Authorization: token ${{ secrets.REPO_ACCESS_TOKEN }}" https://api.github.com/repos/jxpeng98/NotionNext-pjx


      - name: Set up Git
        run: |
          git config user.name "jxpeng98"
          git config user.email "jiaxin.peng@outlook.com"
          git fetch
          git config --global push.default simple
          git remote add destination https://x-access-token:${{ secrets.REPO_ACCESS_TOKEN }}@github.com/jxpeng98/NotionNext-pjx.git
          git fetch origin
          git fetch destination
          git checkout -b temporary

      - name: Debugging by cloning
        run: |
          git clone https://x-access-token:${{ secrets.REPO_ACCESS_TOKEN }}@github.com/jxpeng98/NotionNext-pjx.git

      - name: Push changes
        run: |
          git checkout main
          git merge origin/main
          git push destination main

      - name: Cleanup
        run: |
          git checkout main
          git branch -D temporary
